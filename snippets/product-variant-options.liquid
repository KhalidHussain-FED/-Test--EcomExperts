{% comment %}
  Renders product variant options with image swatches for colors and dropdown for sizes

  Accepts:
  - product: {Object} product object.
  - option: {Object} current product_option object.
  - block: {Object} block object.

  Usage:
  {% render 'product-variant-options',
    product: product,
    option: option,
    block: block
  %}
{% endcomment %}

{%- liquid
  assign variants_available_arr = product.variants | map: 'available'
  assign variants_option1_arr = product.variants | map: 'option1'
  assign variants_option2_arr = product.variants | map: 'option2'
  assign variants_option3_arr = product.variants | map: 'option3'

  assign product_form_id = 'product-form-' | append: section.id
-%}

{%- for value in option.values -%}
  {%- assign variant = product.variants | where: option.name, value | first -%}
  {%- liquid
    assign option_disabled = true

    for option1_name in variants_option1_arr
      case option.position
        when 1
          if variants_option1_arr[forloop.index0] == value and variants_available_arr[forloop.index0]
            assign option_disabled = false
          endif
        when 2
          if option1_name == product.selected_or_first_available_variant.option1 and variants_option2_arr[forloop.index0] == value and variants_available_arr[forloop.index0]
            assign option_disabled = false
          endif
        when 3
          if option1_name == product.selected_or_first_available_variant.option1 and variants_option2_arr[forloop.index0] == product.selected_or_first_available_variant.option2 and variants_option3_arr[forloop.index0] == value and variants_available_arr[forloop.index0]
            assign option_disabled = false
          endif
      endcase
    endfor
  -%}

  {%- if option.name == 'Color' -%}
    <div
      class="variant-swatch {% if option.selected_value == value %}selected{% endif %}"
      data-variant-id="{{ variant.id }}"
    >
      {% assign image_url = '' %}
      {%- case value -%}
        {%- when 'Black' -%}
          {% assign image_url = 'https://khalid-hussain-test.myshopify.com/cdn/shop/products/download.jpg' %}
        {%- when 'Red' -%}
          {% assign image_url = 'https://khalid-hussain-test.myshopify.com/cdn/shop/products/red-bag.png' %}
        {%- when 'Tan' -%}
          {% assign image_url = 'https://khalid-hussain-test.myshopify.com/cdn/shop/products/tan-bag.webp' %}
        {%- else -%}
          {% assign image_url = 'default_image_url.jpg' %}
      {%- endcase -%}
      <img src="{{ image_url | product_img_url: '50x50' }}" alt="{{ value }}">
    </div>
  {%- elsif option.name == 'Size' -%}
    <option
      value="{{ value | escape }}"
      {% if option.selected_value == value %}
        selected="selected"
      {% endif %}
      {% if option_disabled %}
        disabled="disabled"
      {% endif %}
    >
      {%- case value -%}
        {%- when 'Unselected' -%}
          {{ 'Select Size' }}
        {%- when 'Small' -%}
          {{ 'Small' }}
        {%- when 'Medium' -%}
          {{ 'Medium' }}
        {%- when 'Large' -%}
          {{ 'Large' }}
        {%- else -%}
          {{ value }}
      {%- endcase -%}
    </option>
  {%- endif -%}
{%- endfor -%}

{%- if block.settings.picker_type == 'button' -%}
  <input
    type="radio"
    id="{{ section.id }}-{{ option.position }}-{{ forloop.index0 }}"
    name="{{ option.name }}"
    value="{{ value | escape }}"
    form="{{ product_form_id }}"
    {% if option.selected_value == value %}
      checked
    {% endif %}
    {% if option_disabled %}
      class="disabled"
    {% endif %}
  >
  <label for="{{ section.id }}-{{ option.position }}-{{ forloop.index0 }}">
    {{ value }}
    <span class="visually-hidden">{{ 'products.product.variant_sold_out_or_unavailable' | t }}</span>
  </label>
{%- elsif block.settings.picker_type == 'dropdown' -%}
  <!-- Existing dropdown code remains unchanged -->
{%- endif -%}

<script>
  document.addEventListener('DOMContentLoaded', function() {
    var sizeDropdown = document.getElementById('size-dropdown');

    sizeDropdown.addEventListener('change', function() {
      var selectedSize = this.value;
      updateSelectedSize(selectedSize);
    });

    function updateSelectedSize(selectedSize) {
      // Your logic to handle the selected size goes here
      // For example, you can update other elements or perform other actions based on the selected size
    }
  });
</script>
<style>
    /* Image Swatches */
  .variant-swatch {
    display: inline-block;
    margin-right: 10px;
    cursor: pointer;
  }

  .variant-swatch img {
    width: 50px;
    height: 50px;
    border: 1px solid #ccc;
  }

  .variant-swatch.selected {
    border-color: #000;
  }

  /* Size Dropdown */
  #size-dropdown {
    margin-top: 10px;
    padding: 8px;
    font-size: 14px;
  }

  #size-dropdown label {
    display: block;
    margin-bottom: 5px;
    font-weight: bold;
  }
</style>
