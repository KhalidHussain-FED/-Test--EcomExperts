{% comment %}
  Renders product variant options with image swatches for colors and a single dropdown for sizes

  Accepts:
  - product: {Object} product object.
  - option: {Object} current product_option object.
  - block: {Object} block object.

  Usage:
  {% render 'product-variant-options',
    product: product,
    option: option,
    block: block
  %}
{% endcomment %}

{%- liquid
  assign product_form_id = 'product-form-' | append: section.id
-%}

{%- for value in option.values -%}
  {%- assign variant = product.variants | where: option.name, value | first -%}

  {%- if option.name == 'Color' -%}
    <div
      class="variant-swatch {% if option.selected_value == value and variant.available %}selected{% endif %}"
      data-variant-id="{{ variant.id }}"
    >
      {% assign image_url = variant.featured_image.src | default: product.featured_image.src %}
      <img src="{{ image_url | img_url: '50x50' }}" alt="{{ value }}">
    </div>
  {%- elsif option.name == 'Size' -%}
    <select
      id="{{ section.id }}-{{ option.position }}-{{ forloop.index0 }}"
      name="{{ option.name }}"
      form="{{ product_form_id }}"
      {% unless variant.available %}
        disabled="disabled"
      {% endunless %}
    >
      <option
        value="Unselected"
        {% if option.selected_value == 'Unselected' %}
          selected
        {% endif %}
      >
        Unselected
      </option>
      {% for size in product.options_with_values.size.values %}
        <option
          value="{{ size }}"
          {% if option.selected_value == size %}
            selected
          {% endif %}
        >
          {{ size }}
        </option>
      {% endfor %}
    </select>
  {%- endif -%}
{%- endfor -%}

{%- if block.settings.picker_type == 'button' -%}
  <button
    id="{{ section.id }}-{{ option.position }}-{{ forloop.index0 }}"
    name="{{ option.name }}"
    value="{{ option.values.first }}"
    form="{{ product_form_id }}"
    {% unless variant.available %}
      disabled="disabled"
    {% endunless %}
  >
    {{ option.values.first }}
  </button>
{%- endif -%}

{%- if block.settings.picker_type == 'dropdown' -%}
  <select
    id="{{ section.id }}-{{ option.position }}-{{ forloop.index0 }}"
    name="{{ option.name }}"
    form="{{ product_form_id }}"
    {% unless variant.available %}
      disabled="disabled"
    {% endunless %}
  >
    {%- for value in option.values -%}
      <option
        value="{{ value | escape }}"
        {% if option.selected_value == value %}
          selected
        {% endif %}
      >
        {{ value }}
      </option>
    {%- endfor -%}
  </select>
{%- endif -%}

<script>
  document.addEventListener('DOMContentLoaded', function() {
    var swatches = document.querySelectorAll('.variant-swatch');
    var productImage = document.getElementById('product-image');

    swatches.forEach(function(swatch) {
      swatch.addEventListener('click', function() {
        var variantId = this.getAttribute('data-variant-id');
        var variant = findVariantById(variantId);

        if (variant && variant.featured_image) {
          var imageUrl = variant.featured_image.src;
          updateProductImage(imageUrl);
        }
      });
    });

    function findVariantById(variantId) {
      return {{ product | json }}.variants.find(function(variant) {
        return variant.id === variantId;
      });
    }

    function updateProductImage(imageUrl) {
      productImage.src = imageUrl;
    }
  });
</script>

<style>
  /* Image Swatches */
  .variant-swatch {
    display: inline-block;
    margin-right: 10px;
    cursor: pointer;
  }

  .variant-swatch img {
    width: 50px;
    height: 50px;
    border: 1px solid #ccc;
  }

  .variant-swatch.selected {
    border-color: #000;
  }
</style>
